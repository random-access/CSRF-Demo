diff -Naur src-vuln/public/dashboard.php src-fixed/public/dashboard.php
--- src-vuln/public/dashboard.php	2016-05-19 15:01:55.482603246 +0200
+++ src-fixed/public/dashboard.php	2016-05-19 15:01:39.334469383 +0200
@@ -28,6 +28,7 @@
 
                         <!-- Form for uploading pics -->
                         <form action="upload.php" method="POST" enctype="multipart/form-data">
+                            <input type="hidden" name="csrf_token" value=<?php echo($_SESSION['csrf_token']) ?> />
                             <div class="col-md-6">
                                 <label class="button control-label" style="height:1em">
                                     <span class="btn btn-default btn-file">
@@ -46,6 +47,7 @@
 
                         <!-- Form for deleting all pics-->
                         <form method="POST" action="delete.php" class="form-horizontal">
+                            <input type="hidden" name="csrf_token" value=<?php echo($_SESSION['csrf_token']) ?> />
                             <div class="col-md-2">
                                 <button class="btn btn-danger" type="submit" name="submit" id="btn-delete">
                                     <i class="fa fa-btn fa-trash"></i>Alle löschen
diff -Naur src-vuln/public/delete.php src-fixed/public/delete.php
--- src-vuln/public/delete.php	2016-05-19 20:42:56.126662514 +0200
+++ src-fixed/public/delete.php	2016-05-19 15:01:03.046168561 +0200
@@ -1,6 +1,15 @@
 <?php
     require("authenticate.php");
 
+    session_start();
+
+    // test if CSRF token is valid, redirect to login page if not
+    if (!isset($_POST["csrf_token"]) || $_POST["csrf_token"] !== $_SESSION["csrf_token"]) {
+        error_log("CSRF token not matching");
+        header("Location: index.php?error=1004");
+        exit;
+    }
+
     // get user dir
     $target_dir ="uploads/" . $_SESSION["user"];
 
diff -Naur src-vuln/public/edit-profile.php src-fixed/public/edit-profile.php
--- src-vuln/public/edit-profile.php	2016-05-19 13:58:33.595078122 +0200
+++ src-fixed/public/edit-profile.php	2016-05-19 14:28:33.813984121 +0200
@@ -19,7 +19,7 @@
                       print Message::success_update();
                   }
                 ?>
-                
+
                 <div class="panel panel-default">
                     <div class="panel-heading">
                        Profil bearbeiten
@@ -27,6 +27,7 @@
                     <div class="panel-body">
                         <div class="form-group row">
                             <form method="POST" action="update-profile.php" class="form-horizontal">
+                                <input type="hidden" name="csrf_token" value=<?php echo($_SESSION['csrf_token']) ?> />
                                 <div class="form-group row">
                                     <div class="col-md-3 col-md-offset-1">
                                         <label class="control-label">Neues Passwort</label>
diff -Naur src-vuln/public/index.php src-fixed/public/index.php
--- src-vuln/public/index.php	2016-05-19 13:25:15.134560813 +0200
+++ src-fixed/public/index.php	2016-05-20 13:31:29.591796041 +0200
@@ -1,5 +1,18 @@
 <!DOCTYPE html>
 <html lang="de">
+  <?php
+      session_start();
+
+      if (isset($_SESSION["login"]) && $_SESSION["login"] == "ok") {
+          header("Location: dashboard.php");
+          exit;
+      }
+
+      $presession_csrf_token = base64_encode(openssl_random_pseudo_bytes(32));
+      $_SESSION['status']="anonymous";
+      $_SESSION['presession_csrf_token']=$presession_csrf_token;
+  ?>
+
   <?php include 'template/head.php';?>
 
   <body>
@@ -20,6 +33,7 @@
                   </div>
                   <div class="panel-body">
                       <form method="POST" action="login.php" class="form-horizontal">
+                          <input type="hidden" name="presession_csrf_token" value=<?php echo($_SESSION['presession_csrf_token']) ?> />
                           <!-- User name -->
                           <div class="form-group ">
                               <label class="col-md-4 control-label">Benutzername</label>
diff -Naur src-vuln/public/info.php src-fixed/public/info.php
--- src-vuln/public/info.php	1970-01-01 01:00:00.000000000 +0100
+++ src-fixed/public/info.php	2016-05-20 13:29:27.554644529 +0200
@@ -0,0 +1,3 @@
+<?php
+phpinfo();
+ ?>
diff -Naur src-vuln/public/login.php src-fixed/public/login.php
--- src-vuln/public/login.php	2016-05-19 14:44:32.161951768 +0200
+++ src-fixed/public/login.php	2016-05-20 13:33:30.968931897 +0200
@@ -1,9 +1,22 @@
 <?php
     require("../config.php");
 
-    // start session
+    // fetch presession
     session_start();
 
+    // if already logged in, redirect to dashboard
+    if (isset($_SESSION["login"]) && $_SESSION["login"] == "ok") {
+        header("Location: dashboard.php");
+        exit;
+    }
+
+    // test if presession CSRF token is valid, redirect to login page if not
+    if (!isset($_POST["presession_csrf_token"]) || $_POST["presession_csrf_token"] !== $_SESSION["presession_csrf_token"]) {
+        error_log("Presession CSRF token not matching");
+        header("Location: index.php?error=1004");
+        exit;
+    }
+
     // either password or user field was empty
     if (empty($_POST["user"]) && empty($_POST["password"])) {
         header("Location: index.php?error=1001");
@@ -32,6 +45,19 @@
 
     // verify password
     if ($query->fetch() && password_verify($password, $hash)) {
+
+      // unset presession cookie on client
+      if (isset($_COOKIE[session_name()])) {
+        setcookie(session_name(), "", time()-42000, "/");
+      }
+
+      // remove all presession variables & destroy old session
+      session_regenerate_id(true);
+
+      // generate CSRF token and add it to session
+      $csrf_token = base64_encode(openssl_random_pseudo_bytes(32));
+      $_SESSION['csrf_token']=$csrf_token;
+
       // correct password - redirect to welcome.php
       $_SESSION["user"] = $user;
       $_SESSION["login"] = "ok";
diff -Naur src-vuln/public/Message.php src-fixed/public/Message.php
--- src-vuln/public/Message.php	2016-05-19 13:51:13.503456401 +0200
+++ src-fixed/public/Message.php	2016-05-19 13:51:24.223544423 +0200
@@ -15,6 +15,9 @@
                 case 1003:
                   $msg .= "<strong>Login nicht möglich!</strong> Benutzername unbekannt oder Passwort nicht korrekt.";
                   break;
+                case 1004:
+                  $msg .= "<strong>Unautorisierter Zugriff!</strong> Ungültiges Token. Möglicherweise ist die vorherige Seite manipuliert worden.";
+                  break;
 
                 /* Error messages for upload */
                 case 2001:
diff -Naur src-vuln/public/update-profile.php src-fixed/public/update-profile.php
--- src-vuln/public/update-profile.php	2016-05-19 14:44:05.193728002 +0200
+++ src-fixed/public/update-profile.php	2016-05-19 14:43:54.885642468 +0200
@@ -2,6 +2,13 @@
     require("../config.php");
     require("authenticate.php");
 
+    // test if CSRF token is valid, redirect to login page if not
+    if (!isset($_POST["csrf_token"]) || $_POST["csrf_token"] !== $_SESSION["csrf_token"]) {
+        error_log("CSRF token not matching");
+        header("Location: index.php?error=1004");
+        exit;
+    }
+
     // fetch user and password data
     $user = $_SESSION["user"];
     $password = $_POST["password"];
diff -Naur src-vuln/public/upload.php src-fixed/public/upload.php
--- src-vuln/public/upload.php	2016-05-19 13:28:18.000076508 +0200
+++ src-fixed/public/upload.php	2016-05-19 14:33:21.796383449 +0200
@@ -1,6 +1,13 @@
 <?php
     require("authenticate.php");
 
+    // test if CSRF token is valid, redirect to login page if not
+    if (!isset($_POST["csrf_token"]) || $_POST["csrf_token"] !== $_SESSION["csrf_token"]) {
+        error_log("CSRF token not matching");
+        header("Location: index.php?error=1004");
+        exit;
+    }
+
     // create upload folder (uploads/[username]) if not existing
     $target_dir = "uploads/" . $_SESSION["user"];
     if (!file_exists($target_dir)) {
